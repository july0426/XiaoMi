!function(e){function t(o){if(i[o])return i[o].exports;var a=i[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){i(4),i(5),i(6),i(2),i(7),i(10),$.productBuy=function(e){var t={isLogin:$.cookie("cUserId")?!0:!1,serverTime:"//time.hd.mi.com/gettimestamp",elm:$("#J_buyBox"),hdUrl:"//a.huodong.mi.com",hdloginUrl:"//i.huodong.mi.com/site/login?redirectUrl="+location.href,staticUrl:MI.GLOBAL_CONFIG.staticSite+"/buySuccess/?gid=",orderapi:window.orderapi_host,orderSite:MI.GLOBAL_CONFIG.orderSite||"//order.mi.com",loginUrl:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/site/login?redirectUrl="+location.href,addAddressUrl:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/user/address?redirectUrl="+location.href+"&autoShow=1",addressListUrl:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/address/getAddressList",orderSubmitUrl:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/buyService/buyServiceCreate2",bookRule:(MI.GLOBAL_CONFIG.orderSite||"//order.mi.com")+"/product/bookingRules"},i=function(e){var t={type:"GET",url:e.url,dataType:"jsonp",jsonp:"jsonpcallback",data:e.data||"",timeout:1e4,error:function(t){var i=e.error;i&&i(t)},success:function(t){var i=e.callback;i&&i(t)}};e.jsonpCallback&&(t.jsonpCallback=e.jsonpCallback),$.ajax(t)},o=function(e,t){var i=$('<iframe width="0" height="0" name="ihuodong"></iframe>');i.attr("src",t),$("body").append(i),$('iframe[name="ihuodong"]').load(function(){"function"==typeof e&&e(),$('iframe[name="ihuodong"]').remove(),a.proxy=1})},a={proxy:0,select:0,pid:e.id,product:"",parts:[],install:[],stockData:[],presalesData:[],hdinfoData:[],hdinfoBookingData:[],hdinfoPresalesData:[],bigtapDataId:[],bigtapDataType:[],stockDataId:[],presalesDataId:[],chooseResult:{},selectedAddr:[],safety:null,mitvMember:null,allGoods:[],sortData:[],coupon:!1,couponData:[],orderData:{},saltTitle:"",address:!1,goodsStock:0,mihomeId:"",slider:""},n=function(){var e="fix",t=$(window).scrollTop(),i=$("#J_img"),o=$("#J_proHeader").offset().top||140,a=i.offset().top,n=function(){var n=0;$(".login-notic").hasClass("hide")||(n=48),t>=a-64&&t>=o+n?(i.addClass(e).css({left:$(".pro-choose-main").offset().left}),t>=$("#J_proInfo").offset().top-640-n?(i.removeClass(e),i.css({marginTop:$(".pro-info").height()-560-n+"px"})):i.css({marginTop:0})):i.removeClass(e)};$(window).on("scroll.fix",function(){t=$(this).scrollTop(),n()}),n(),$(window).on("resize.fix",function(){n()})},s=function(e){var t=new Image;return t.src=e.data("src"),t.complete?void e.attr("src",t.src).addClass("done"):void(t.onload=function(){e.attr("src",t.src).addClass("done")})},r=function(){function e(e,t){var i=$(e),o=i.find(".slider").eq(t);o.hasClass("done")||o.attr("src",o.data("src")).addClass("done")}a.slider&&a.slider.destroySlider();var t=$("#J_sliderView");$(".J_imgload").addClass("hide"),$("#J_img").removeClass("hide"),a.slider=t.slider({infiniteLoop:!0,hideControlOnEnd:!0,mode:"fade",auto:!0,autoHover:!0,onSliderLoad:function(i){e(t,i),$("#J_img").find(".slider").length<=1&&$("#J_img").find(".ui-controls").hide()},onSlideBefore:function(i,o,a){e(t,a)},startSlide:0})},d={config:$.extend(t,e),selectSafety:function(e,t){var i=this,o=e.find("li");o.on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),a[t]=null):(o.removeClass("active"),$(this).addClass("active"),a[t]={id:$(this).data("id"),name:$(this).data("name"),price:$(this).data("price")}),i.formateProList()})},formateProList:function(){if(a.parts.length||a.install.length||null!==a.safety||""!==a.product){var e=doT.template($("#J_proListTmp").html());$("#J_proList").removeClass("hide").html(e(a))}else $("#J_proList").addClass("hide")},selectList:function(e,t){var i=this,o=e.find("li"),n=o.find("a"),s=e.find(".J_listDescBox"),r=e.find(".J_listTips"),d=s.find(".J_listNum"),l={},c={},h={},p=function(){var e="",t=0,i=0;for(var o in l)(""!==l[o]||0===l[o])&&(e+=l[o]+"、",t+=parseFloat(c[o]),i+=parseFloat(h[o]));e=e.substring(0,e.length-1),s.find(".desc").html(e).end().find(".price").addClass(i===t?"":"del").html((i===t?"":"<del>"+i+"元</del>")+t+"元 ")},g=function(e,t){e.find(".img").attr("src",t.data("img")).end().find(".name").html(t.data("name")).end().find(".price").find("em").html(t.data("price")),e.find(".price").find("del").html(parseFloat(t.data("price"))<parseFloat(t.data("originalprice"))?t.data("originalprice"):"")},u=function(e){1===e?(s.addClass("hide"),r.removeClass("hide")):(s.removeClass("hide"),r.addClass("hide"))},f=function(e,t){var i=[],o=$(t).data("id"),a=$(t).parents("li").index();return $.each(e,function(e,t){t.id!==o&&t.index!==a&&i.push(t)}),i},m=function(e,i){l[e]=i.data("name"),c[e]=i.data("price"),h[e]=i.data("originalprice"),a[t].push({index:i.parents("li").index(),item:i.index(),id:i.data("id"),is_bargain:i.data("is_bargain")||!1,bargain_id:i.data("bargain_id")||"",name:l[e],price:c[e]})};n.on("click",function(){if(!$(this).hasClass("active")){var e=$(this).parents("li");$(this).addClass("active").siblings("a").removeClass("active"),g(e,$(this)),e.hasClass("active")&&(a[t]=f(a[t],e.find(".active")),m(e.index(),$(this)),i.formateProList(),p())}});var v=o.find("i");v.on("click",function(){var e=$(this).parents("li"),o=e.index();e.hasClass("active")?(e.removeClass("active"),l[o]="",c[o]=0,h[o]=0,a[t]=f(a[t],e.find(".active")),g(e,e.find("a").eq(0)),e.siblings("li").hasClass("active")?d.html(parseFloat(d.html())-1):(d.html("0"),u(1))):(e.addClass("active"),d.html(parseFloat(d.html())+1),u(),m(o,e.find(".active"))),p(),i.formateProList()});var b=e.find(".J_extend"),_=e.find("ul");b.on("click",function(){_.toggleClass("hide"),b.hasClass("active")?(b.removeClass("active").html("&#xe61b;"),0===parseFloat(d.html())&&(s.addClass("hide"),r.removeClass("hide"))):(b.addClass("active").html("&#xe612;"),0===parseFloat(d.html())?(s.addClass("hide"),r.removeClass("hide")):(s.removeClass("hide"),r.addClass("hide")))}),e.find(".J_listDelete").on("click",function(){u(1);for(var e=0,n=o.length;n>e;e++)o.eq(e).removeClass("active").find("i").removeClass("active");a[t]=[],l={},d.html(0),i.formateProList()})},buyCountDown:function(e){var t,i,o,a,n=this;clearInterval(n.msTimer),t=Math.floor(e%60),i=Math.floor(e/60%60),o=Math.floor(e/3600%24),a=Math.floor(e/86400)>0?Math.floor(e/86400):"";var s=(a>0?a+"天 ":"")+(o>0?o+"小时 ":"")+(i>0?i+"分钟 ":""),r=10;n.msTimer=setInterval(function(){r-=1,$(".J_timer").find("span").html(s+(t>0?t:0)+"."+r+"秒 ")},100)},countDown:function(){var e=this;$.miCountdown({startTime:a.hdstarttime,endTime:a.hdendtime,onTime:function(t){0===$(".countdown").find(".J_timer").length&&$(".countdown").html('<a href="javascript:void(0);" class="btn btn-gray-line btn-biglarge" data-type="bigtap">'+$(".countdown").data("name")+'</a><div class="J_timer">距离开始还有 <span ></span></div>'),window.now=t,e.buyCountDown(t)},onStart:function(){e.changeBuy()},onEnd:function(){e.changeBuy("end")}})},changeBuy:function(e){var t=this;$(".J_timer").remove(),clearInterval(this.msTimer);var i="";i="end"===e?'<a data-type="bigtap" data-sign="disabled" class="btn btn-line-primary btn-biglarge J_setRemind" href="javascript:void(0);">设置开售提醒</a>':t.config.isLogin?'<a href="javascript:void(0);"  class="btn btn-primary btn-biglarge J_proBuyBtn add" id="J_proAddcart"  data-gid="'+a.id+'"data-type="bigtap">加入购物车</a>':'<a href="'+t.config.loginUrl+'"  class="btn btn-primary btn-biglarge ">登录后购买</a>',$("#J_buyBtnBox").find(".btn").replaceWith(i)},setRemind:function(){var e=this,t=$(".J_setRemind"),o=t.data("type"),n=t.data("tip");n=n?n:"已设置开售提醒";var s=function(){$(".J_setRemind").replaceWith('<a class="btn btn-disabled btn-gray-line btn-biglarge J_setRemindBtn"  data-type="'+o+'" data-sign="disabled" href="javascript:void(0);">'+n+'</a><span class="J_cancleRemind">取消提醒</span>')},r=function(){$(".J_setRemindBtn").next().remove().end().replaceWith('<a class="btn btn-line-primary btn-biglarge J_setRemind" href="javascript:void(0);" data-type="'+o+'"  data-sign="disabled"  " >设置开售提醒</a>')};$("body").on("click",".J_setRemind",function(t){t.preventDefault(),i({url:e.config.orderSite+"/misc/onsaleRegister",data:{goods_id:a.id},callback:function(t){1===t.code?(s(),$("#J_setRemindModal").modal("show")):-2===t.code&&(window.location.href=e.config.loginUrl)}})}),$("body").on("click",".J_cancleRemind",function(t){t.preventDefault(),i({url:e.config.orderSite+"/misc/onsaleCleanup",data:{goods_id:a.id},callback:function(t){1===t.code?r():-2===t.code&&(window.location.href=e.config.loginUrl)}})}),i({url:e.config.orderSite+"/misc/onsaleCheck",data:{goods_list:a.id},callback:function(e){1===e.code&&0!==e.data.length&&""!==e.data[a.id]&&s()}})},loopGoods:function(e,t,o){var n=this,d=this.config.list.check_index[e],l=[];if($.each(a.allGoods,function(i,o){if(parseFloat(o.level)===e+1){var a=!1;$.each(t,function(e,t){t.hasChild=!1,(o.name===t.value||t.name===o.name)&&(a=!0,o.name===t.value&&(t.isExist=!0,t.child=o.child),l.push(t))}),a||(t.push(o),l.push(o))}}),""!==d.val){var c=!1;$.each(t,function(e,t){t.value===d.val&&(d.index=e,c=!0)}),c||(d.index=0,d.val=t[d.index].value)}else d.index=d.index,d.val=t[d.index].value;$.each(l,function(t,i){if(i.list){var s=n.config.list.check_index[e+1].val;$.each(i.child,function(e,t){if(""!==s){if(t.value===s)return void(i.hasChild=!0)}else for(var o=a.allGoods,n=0,r=o.length;r>n;n++)if(parseFloat(i.level)+1===parseFloat(o[n].level)){t.value===o[n].name&&(i.hasChild=!1);break}})}else o&&o.child?$.each(o.child,function(e,t){t.value===i.value&&(i.hasChild=!0)}):i.hasChild=!0});var h={index:e,num:d,data:l},p="";if(p=doT.template(l[d.index].list?$("#J_proTmp").html():$("#J_proTmp2").html()),$("#J_list").append(p(h)).find("img").each(function(){s($(this))}),d=d.index,t[d].list)this.loopGoods(e+1,t[d].list,t[d]);else{var g=t[d].goods.services;g&&g.insurance&&(g.insurance.href=this.config.orderSite+"/product/insurance?type=",p=doT.template($("#J_insuranceTmp").html()),$("#J_list").append(p(g.insurance)),$("#J_safety").removeClass("hide")),p=doT.template($("#J_proImgTmp").html()),$("#J_sliderView").html(p(t[d].goods)),0!==t[d].goods.images.length&&r(),a.product={name:t[d].goods.goods_name,market_price:t[d].goods.market_price,price:t[d].goods.goods_price},a.id=t[d].goods.goods_id,a.cid=t[d].goods.commodity_id,n.relationCallback(),t[d].stockData=a.stockData,t[d].presalesData=a.presalesData,t[d].hdinfoData=a.hdinfoData,t[d].hdinfoBookingData=a.hdinfoBookingData,t[d].hdinfoPresalesData=a.hdinfoPresalesData,a.hdinfoData[a.id]&&(a.hdendtime=a.hdinfoData[a.id].endtime||0,a.hdstarttime=a.hdinfoData[a.id].starttime||0),a.hdinfoPresalesData[a.id]&&(a.hdendtime=a.hdinfoPresalesData[a.id].endtime||0,a.hdstarttime=a.hdinfoPresalesData[a.id].starttime||0),a.hdinfoBookingData[a.id]&&(a.hdendtime=a.hdinfoBookingData[a.id].endtime||0,a.hdstarttime=a.hdinfoBookingData[a.id].starttime||0),t[d].hdendtime=a.hdendtime,t[d].hdstarttime=a.hdstarttime,t[d].orderData=a.orderData,t[d].href=this.config.loginUrl,t[d].isLogin=this.config.isLogin,p=doT.template($("#J_buyBtnTmp").html()),$("#J_buyBtnBox").html(p(t[d]));var u=$("#J_policy");if(u.addClass("hide"),g&&g.service_refound_policy){var f=g.service_refound_policy;f&&0!==f.length&&(u.removeClass("hide").find(".J_tips").html(f.description),f.is_support?u.find(".nosupport").addClass("hide").end().find(".support").removeClass("hide"):u.find(".support").addClass("hide").end().find(".nosupport").removeClass("hide"))}if($(".J_proPrice").html(a.product.price+"元 "+(parseFloat(a.product.market_price)>parseFloat(a.product.price)?"<del>"+a.product.market_price+"元</del>":"")),"booking"===t[d].goods.actions[0].type){$(".J_proBook,#J_bookFlow").removeClass("hide");var m=t[d].goods.booking_info;a.bookPrice=m.price,$(".J_bookPrice").html(m.price),a.bookStarttime=m.pre_start_time,a.bookEndtime=m.pre_end_time,$("#J_bookFlow").find(".item-infor").eq(0).html(n.formatBookTime(m.pre_start_time)+" - "+n.formatBookTime(m.pre_end_time)),$("#J_bookFlow").find(".item-infor").eq(1).html(n.formatBookTime(m.final_start_time)+" - "+n.formatBookTime(m.final_end_time)),a.saltTitle=m.sale_title,$("#J_bookFlow").find(".item-infor").eq(2).html(a.saltTitle),n.getBookTime(),i({url:n.config.bookRule,data:{product_id:a.id},callback:function(e){e&&1===e.code?($(".J_bookRuleTips").removeClass("hide"),$(".J_bookRuleCon").find("div").html(e.data.rules_detail)):$(".J_bookRuleTips").addClass("hide")}})}else $(".J_proBook,#J_bookFlow").addClass("hide");if("presales"===t[d].goods.actions[0].type){var v=t[d].goods.presales_info;a.saltTitle=v.sale_title}}},bookCountdown:function(e){window.surplusTime=0;var t={startTime:"",endTime:"",onTime:$.noop,onStart:$.noop,onEnd:$.noop},i=$.extend(t,e);if(i.startTime&&i.endTime){var o=$.isNumeric(i.startTime)?i.startTime:new Date(i.startTime).getTime()/1e3,a=$.isNumeric(i.endTime)?i.endTime:new Date(i.endTime).getTime()/1e3,n=function(){var e=parseInt((new Date).getTime()/1e3)+window.diffTime;if(window.surplusTime=o-e,i.timer&&clearTimeout(i.timer),e>=o&&a>e)"function"==typeof i.onStart&&i.onStart(a-e);else if(e>=a){if("function"==typeof i.onEnd)return void i.onEnd(e)}else i.onTime(window.surplusTime);i.timer=setTimeout(function(){n()},1e3)};this.getserverTime(n)}},getserverTime:function(e){var t=this;return window.diffTime=0,window.servertime?void e(window.servertime):void $.ajax({url:t.config.serverTime,dataType:"script",cache:!0,timeout:1e4,error:function(){"function"==typeof e&&e(window.servertime),window.servertime=(new Date).getTime()/1e3},success:function(){window.servertime&&"number"==typeof window.servertime?(window.servertime=window.servertime,window.diffTime=window.servertime-parseInt((new Date).getTime()/1e3)):window.servertime=(new Date).getTime()/1e3,"function"==typeof e&&e(window.servertime)}})},getBookTime:function(){var e=this;this.bookCountdown({startTime:a.bookStarttime,endTime:a.bookEndtime,onStart:function(t){e.bookTime(t)},onEnd:function(){$(".J_bookTime").html("预售已结束"),a.isBigtap=$("#J_buyBtnBox").find(".btn").data("isbigtap"),$("#J_buyBtnBox").find(".btn").replaceWith('<a data-sign="disabled" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'" class="btn btn-line-primary btn-biglarge J_setRemind" href="javascript:void(0);" >设置开售提醒</a>'),e.setRemind()}})},bookTime:function(e){var t=Math.floor(e%60),i=Math.floor(e/60%60),o=Math.floor(e/3600%24),a=Math.floor(e/86400)>0?Math.floor(e/86400):"";10>o&&(o="0"+o),10>i&&(i="0"+i),10>t&&(t="0"+t),a=a>0?a+" 天 ":"";var n="剩 "+a+o+" 时 "+i+" 分 "+t+" 秒";$(".J_bookTime").html(n)},formatBookTime:function(e){function t(e,t){return(10>e?"0"+e:e)+t}var i=new Date(1e3*parseInt(e)),o=i.getFullYear()+"年",a=t(i.getMonth()+1,"月"),n=t(i.getDate(),"日 "),s=t(i.getHours(),":"),r=t(i.getMinutes(),"");return o+a+n+s+r},hideLoadNotic:function(){var e=this;$(".J_proLoginClose").on("click",function(){e.config.elm.find(".J_notic").slideUp("fast","linear"),e.config.isLoginClose=!0})},formatPro:function(e){var t=this;t.config.isLogin||(t.config.list.isLogin=t.config.isLogin,t.config.list.href=t.config.loginUrl,t.config.elm.find(".J_proLogin").attr("href",t.config.loginUrl).end().find(".J_notic").removeClass("hide")),t.config.elm.find(".J_error,.J_load").addClass("hide").end().find(".J_main").removeClass("hide"),a.safety=null,a.mitvMember=null,$("#J_list").html(""),t.loopGoods(0,t.config.list.list),t.selectStep(),t.selectSafety($("#J_safety"),"safety"),t.selectSafety($("#J_mitvMemberty"),"mitvMember");var i=$("#J_buyBtnBox").find(".btn");a.type=i.data("type"),a.isbigtap=i.data("isbigtap"),t.addressInit(a.isBigtap,e),t.formateProList()},addressInit:function(e,t){a.selectedAddr.length?a.need_address_check&&a.address?(this.changeAddress().changRelation(),this.changeAddress().setBuy(t),"bigtap"===a.type&&(a.hdinfoData[a.id]&&2===a.hdinfoData[a.id].hdstatus||this.changeAddress().setSoldout()),"common"===a.type&&(a.stockData[a.id]||this.changeAddress().setSoldout()),"presales"===a.type&&(a.isbigtap?a.hdinfoPresalesData[a.id]&&2===a.hdinfoPresalesData[a.id].hdstatus||this.changeAddress().setSoldout():a.presalesData[a.id]||this.changeAddress().setSoldout()),"booking"===a.type&&(a.isbigtap?a.hdinfoBookingData[a.id]&&2===a.hdinfoBookingData[a.id].hdstatus||this.changeAddress().setSoldout():a.presalesData[a.id]||this.changeAddress().setSoldout())):this.checkSelectAddr(e):(this.chooseRegionsInit(e),a.coupon||l.init())},chooseRegionsInit:function(e,t){var i=this;MI.buyChooseAddress.init({showTrigger:"#J_switchChooseRegions",afterChoose:function(o,n){o&&o.length&&(a.selectedAddr=o,n&&(a.mihomeId=n),$("#J_modalChooseRegions").modal("hide"),a.need_address_check&&!a.address&&0===a.goodsStock?i.getGoodsStock():i.checkSelectAddr(e,t))}})},changeAddress:function(e){var t=this,i=$("#J_productStatus");return{changRelation:function(){var i=$("#J_relation");"disabled"!==$("#J_buyBtnBox").find(".btn").data("sign")?(t.relation&&t.relation.length>0&&""!==i.attr("style")&&i.stop().animate({height:"133px"},300,"linear",function(){i.attr("style","")}),"bigtap"===a.type&&(a.hdinfoData&&3===a.hdinfoData[a.id].hdstatus?$("#J_buyBtnBox").find(".btn").replaceWith('<a data-sign="disabled" class="btn btn-gray-line btn-biglarge" href="javascript:void(0);" >已售罄</a>'):(t.countDown(),t.changeAddress(e).setBuy())),"booking"===a.type&&(a.isbigtap&&a.hdinfoBookingData.length>0&&3===a.hdinfoBookingData[a.id].hdstatus?$("#J_buyBtnBox").find(".btn").replaceWith('<a data-sign="disabled" class="btn btn-gray-line btn-biglarge" href="javascript:void(0);" >已售罄</a>'):t.getBookTime()),"presales"===a.type&&a.isbigtap&&a.hdinfoPresalesData.length>0&&3===a.hdinfoPresalesData[a.id].hdstatus&&$("#J_buyBtnBox").find(".btn").replaceWith('<a data-sign="disabled" class="btn btn-gray-line btn-biglarge" href="javascript:void(0);" >已售罄</a>')):(t.setRemind(),t.relation&&t.relation.length>0&&i.stop().animate({height:0},300,"linear",function(){i.css("overflow","hidden")}))},setBtnRemind:function(){e&&"reserve_new"!==a.type&&(a.type=$("#J_buyBtnBox").find(".btn").data("type"),a.isBigtap=$("#J_buyBtnBox").find(".btn").data("isbigtap"),$("#J_buyBtnBox").find(".btn").replaceWith('<a data-sign="disabled" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'" class="btn btn-line-primary btn-biglarge J_setRemind" href="javascript:void(0);" >设置开售提醒</a>')),this.changRelation()},setNoserver:function(){this.setBtnRemind(),i.addClass("noserver").removeClass("over active presales booking").find(".time").html("")},setSoldout:function(){this.setBtnRemind(),i.addClass("soldout").removeClass("active noserver presales").find(".time").html("")},setBuy:function(t){if(i.removeClass("soldout noserver active presales book").find(".time").html(t?t.data.est_delivery_desc:""),"presales"===a.type?(i.addClass("presales"),i.find(".time").html(a.saltTitle)):"booking"===a.type?(i.addClass("booking"),i.find(".time").html(a.saltTitle)):i.addClass("active"),e){var o=$("#J_buyBtnBox").find(".btn");if(a.type=o.data("type"),a.isBigtap=o.data("isbigtap"),"bigtap"===a.type)return void o.replaceWith('<a href="javascript:void(0);" class="btn btn-primary btn-biglarge J_proBuyBtn" id="J_proAddcart" data-type="'+a.type+'">加入购物车</a>');if("presales"===a.type)return void o.replaceWith('<a href="javascript:void(0);" class="btn btn-primary  btn-biglarge J_proBuyBtn" id="J_proBuyPresales" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'">预售购买</a>');if("booking"===a.type)return void(o.hasClass("J_bookBtn")&&o.replaceWith('<a href="javascript:void(0);" class="btn btn-primary  btn-biglarge J_proBuyBtn" id="J_proBuyBooking" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'">支付预付款</a>'));if("reserve_new"===a.type)return void o.replaceWith('<a href="javascript:void(0);" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'" class="btn btn-primary btn-biglarge J_orderBtn" href="javascript:void(0);" >立即预约</a>');o.replaceWith('<a href="javascript:void(0);" data-type="'+a.type+'" data-isbigtap="'+a.isBigtap+'" class="btn btn-primary btn-biglarge J_proBuyBtn" href="javascript:void(0);" >加入购物车</a>')}},changgeInfor:function(i){1===i.data.can_delivery?i.data.is_cos?t.changeAddress(e).setSoldout(i):"disabled"===$("#J_buyBtnBox").find(".btn").data("sign")?t.changeAddress(e).setSoldout(i):(t.changeAddress(e).setBuy(i),t.changeAddress(e).changRelation()):t.changeAddress(e).setNoserver(i)}}},checkSelectAddr:function(){var e=this,t=a.need_address_check&&"bigtap"!==a.type,o=a.selectedAddr.length>4?1:0,n={product_id:a.id,item_id:0,province_id:a.selectedAddr[o+0].id,city_id:a.selectedAddr[o+1].id,district_id:a.selectedAddr[o+2].id,area:a.selectedAddr[o+3].id};("presales"===a.type||"booking"===a.type)&&(n.is_presale=1),i({url:MI.GLOBAL_CONFIG.orderSite+"/api/deliverySearch.php",data:n,error:function(){e.changeAddress(t).setNoserver()},callback:function(i){i.isbigtap=a.isbigtap,i&&1===i.code&&1===i.data.can_delivery?(i.data.mihome_id&&(a.mihomeId=i.data.mihome_id),a.goodsStock++,a.need_address_check&&1!==a.goodsStock?(a.address=!0,e.getGoodsStock("",i)):e.changeAddress(t).changgeInfor(i)):e.changeAddress(t).setNoserver()}})},loopCheckIsBigtag:function(e,t){var i=t[parseFloat(this.config.list.check_index[e].index)];return(!i||i&&!i.price_min)&&(i=t[0]),i&&i.list?void this.loopCheckIsBigtag(e+1,i.list):(i=i.goods,i.actions.length>0&&("bigtap"===i.actions[0].type||"booking"===i.actions[0].type&&i.actions[0].isBigtap||"presales"===i.actions[0].type&&i.actions[0].isBigtap)?("bigtap"===i.actions[0].type&&(a.type="bigtap"),"booking"===i.actions[0].type&&(a.type="booking"),"presales"===i.actions[0].type&&(a.type="presales"),a.isbigtap=!0,a.id=i.goods_id,void this.getHdInfoStatus()):void this.formatPro())},checkIsBigtag:function(){return a.need_address_check?void this.getGoodsStock():void this.loopCheckIsBigtag(0,this.config.list.list)},setSelectIndex:function(e,t,i){for(var o=0;o<this.config.list.check_index.length;o++)if(o===e){this.config.list.check_index[o]={val:t,index:i};break}},unselected:function(e,t){var i=this;if(this.config.list.check_index[e].val=t,this.config.list.check_index[this.config.list.check_index.length-1].child=[],!(0>e)){var o=!1;$.each(a.allGoods,function(a,n){n.child.length>0&&$.each(n.child,function(a,s){s.value!==t||o||(i.config.list.check_index[e-1].val=n.name,i.config.list.check_index[e-1].index=n.level,2>e&&(i.config.list.check_index[e+1].val=n.child[0].val),o=!0)})})}},selectStep:function(){var e=this,t=$(".J_step");t.find("li").on("click",function(){if(!$(this).hasClass("active")){var t=$(this).parents(".J_step");if($(this).hasClass("disabled")){if(parseFloat($(this).data("childlen"))>=1)return e.unselected(t.data("index"),$(this).data("value")),void e.checkIsBigtag();var i=$(this);return 0===i.find(".J_tips").length&&i.append('<div class="tips J_tips">暂时无此商品</div>'),i.find(".J_tips").stop().fadeIn(700),void setTimeout(function(){i.find(".J_tips").stop().fadeOut(700)},2e3)}e.setSelectIndex(t.data("index"),String($(this).data("value")),$(this).data("index")),e.checkIsBigtag()}})},getGoodsStock:function(e,t){if(a.stockDataId.length>0){var o=this,n={url:o.config.orderapi+"/stock/listv2?gids="+a.stockDataId.join(","),error:function(){o.checkPresalesDataId(e,t)},callback:function(i){a.stockData=i.data,o.checkPresalesDataId(e,t)}};a.need_address_check&&a.mihomeId&&(n.data={mihome_id:a.mihomeId}),i(n)}else this.checkPresalesDataId("init",t)},selectFirstStock:function(e){for(var t=this,i=e||a.allGoods,o=0;o<i.length;o++){var n=a.allGoods[o];if("bigtap"===n.actions&&a.hdinfoData&&a.hdinfoData[n.id]&&a.hdinfoData[n.id].hdstart&&!a.hdinfoData[n.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name;break}if("presales"===n.actions){if(!n.isBigtap){a.presalesData&&a.presalesData[n.id]&&(t.config.list.check_index[parseFloat(n.level)-1].val=n.name);break}if(a.hdinfoPresalesData&&a.hdinfoPresalesData[n.id]&&a.hdinfoPresalesData[n.id].hdstart&&!a.hdinfoPresalesData[n.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name;break}}if("booking"===n.actions){if(!n.isBigtap){a.presalesData&&a.presalesData[n.id]&&(t.config.list.check_index[parseFloat(n.level)-1].val=n.name);break}if(a.hdinfoBookingData&&a.hdinfoBookingData[n.id]&&a.hdinfoBookingData[n.id].hdstart&&!a.hdinfoBookingData[n.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name;break}}if("common"===n.actions&&a.stockData&&a.stockData[n.id]){t.config.list.check_index[parseFloat(n.level)-1].val=n.name;break}if(""===n.actions){for(var s=!1,r=0;r<n.child.length;r++){var d=n.child[r];if("bigtap"===d.actions&&a.hdinfoData&&a.hdinfoData[d.id]&&a.hdinfoData[d.id].hdstart&&!a.hdinfoData[d.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}if("presales"===d.actions)if(d.isBigtap){if(a.hdinfoPresalesData&&a.hdinfoPresalesData[d.id]&&a.hdinfoPresalesData[d.id].hdstart&&!a.hdinfoPresalesData[d.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}}else if(a.presalesData&&a.presalesData[d.id]){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}if("booking"===d.actions)if(d.isBigtap){if(a.hdinfoBookingData&&a.hdinfoBookingData[d.id]&&a.hdinfoBookingData[d.id].hdstart&&!a.hdinfoBookingData[d.id].hdstop){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}}else if(a.presalesData&&a.presalesData[d.id]){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}if("common"===d.actions&&a.stockData&&a.stockData[d.id]){t.config.list.check_index[parseFloat(n.level)-1].val=n.name,t.config.list.check_index[parseFloat(d.level)-1].val=d.value,s=!0;break}}if(s)break}}},checkPresalesDataId:function(e,t){a.presalesDataId.length>0?this.getPresalesInfo(e,t):a.bigtapDataId.length>0?this.loopBigtap(e,t):("init"===e&&this.selectFirstStock(),this.formatPro(t))},getPresalesInfo:function(e,t){var o=this,n={channel:"presales"};a.need_address_check&&a.mihomeId&&(n.mihome_id=a.mihomeId),i({url:o.config.orderapi+"/stock/listv2?gids="+a.presalesDataId.join(","),data:n,error:function(){o.checkBigtapDataId(e,t)},callback:function(i){a.presalesData=i.data,o.checkBigtapDataId(e,t)}})},checkBigtapDataId:function(e,t){a.bigtapDataId.length>0?this.loopBigtap(e,t):("init"===e&&this.selectFirstStock(),this.formatPro(t))},loopBigtap:function(e,t){for(var i=this,o=0;o<a.bigtapDataType.length;o++)i.getHdInfoStatus(e,t,a.bigtapDataType[o],o)},getHdInfoStatus:function(e,t,o,n){var s=this,r={m:1};r.source="bigtap",a.need_address_check&&a.mihomeId&&(r.storage=a.mihomeId),("presales"===a.type&&a.isbigtap||"presales"===o)&&(r.source="presales_bigtap"),("booking"===a.type&&a.isbigtap||"booking"===o)&&(r.source="booking_bigtap"),i({url:MI.GLOBAL_CONFIG.damiaoSite+"hdinfo/cn",data:r,jsonp:"jsonpcallback",jsonpCallback:"hdinfo_"+r.source,error:function(){n>=a.bigtapDataType.length-1&&o?("init"===e&&s.selectFirstStock(),s.formatPro(t)):"init"!==e&&s.formatPro(t)},callback:function(i){"presales"===a.type&&a.isbigtap||"presales"===o?a.hdinfoPresalesData=i.status:"booking"===a.type&&a.isbigtap||"booking"===o?a.hdinfoBookingData=i.status:a.hdinfoData=i.status,n>=a.bigtapDataType.length-1&&o?("init"===e&&s.selectFirstStock(),s.formatPro(t)):"init"!==e&&s.formatPro(t)}})},addCart:function(){function e(e){e&&1===e.code?(n="booking"===a.type?o.config.orderSite+"/buy/checkout?quick_order=1":o.config.staticUrl+a.id+"&protype=product&pid="+a.pid,a.pid=e.message,i(e)):1!==e.code&&MI.alert({msg:e.msg})}function t(){if(a.parts.length){var e="",t=0,i=[];$.each(a.parts,function(o,s){return i.push(s.is_bargain?s.bargain_id:s.id),t>=a.parts.length-1?void MI.addShopCart(i.join("_"),function(t){e=r(t),location.href=n+e},$(".J_proBuyBtn")):void(t+=1)})}else location.href=null!==a.safety?n+"&insurance=success":n}function i(e){null!==a.safety?MI.addShopCart(a.safety.id,function(e){e&&1===e.code?t():location.href=n+"&insurance=fail"},$(".J_proBuyBtn"),{parent_itemId:a.pid}):t(e)}var o=this,n="";$("body").on("click",".J_proBuyBtn",function(){"common"===a.type?MI.addShopCart(a.id,e):"presales"===a.type?$(this).data("isbigtap")?s($("#J_proBuyPresales")):MI.addShopCart(a.id,e,$("#J_proBuyPresales"),{source:"presales"}):"booking"===a.type?$(this).data("isbigtap")?s($("#J_proBuyBooking")):MI.addShopCart(a.id,e,$("#J_proBuyBooking"),{source:"booking"}):s($("#J_proAddcart"))});var s=function(t){var i="presales"===a.type?"presales_bigtap":"bigtap";i="booking"===a.type?"booking_bigtap":i;var o={obj:t,gid:a.id,callback:e,sourceVal:i,overCallback:function(e){e.removeClass("btn-primary").addClass("btn-dakeLight").html("已售罄").removeClass("J_proBuyBtn")}};a.mihomeId>0&&(o.storage=a.mihomeId),MI.bigtap.init(o)},r=function(e){return e&&1===e.code?null!==a.safety?"&insurance=success&relation=success":"&relation=success":"&relation=fail"}},loopGoodsList:function(e,t){var i=this;$.each(t,function(t,o){var n=o.list||[],s=[];o.list&&$.each(o.list,function(e,t){s.push({value:t.value,level:t.level,isBigtap:t.goods&&t.goods.actions?t.goods.actions[0].isBigtap:!1,actions:t.goods&&t.goods.actions?t.goods.actions[0].type:"",id:t.goods&&t.goods.goods_id?t.goods.goods_id:0})}),a.allGoods.push({title:o.name,name:o.value,level:o.level,child:s,isBigtap:o.goods&&o.goods.actions?o.goods.actions[0].isBigtap:!1,actions:o.goods&&o.goods.actions?o.goods.actions[0].type:"",id:o.goods&&o.goods.goods_id?o.goods.goods_id:0,icon_url:o.goods&&o.goods.icon_url?o.goods.icon_url:"",image:o.goods&&o.goods.image?o.goods.image:""}),n.length>0?i.loopGoodsList(e+1,n):(n=o.goods||[],$.each(n.actions,function(e,t){"bigtap"===t.type?(a.bigtapDataId.push({id:n.goods_id,type:t.type}),a.bigtapDataType.push(t.type)):"presales"===t.type||"booking"===t.type?t.isBigtap?(a.bigtapDataId.push({id:n.goods_id,type:t.type}),a.bigtapDataType.push(t.type)):a.presalesDataId.push(n.goods_id):a.stockDataId.push(n.goods_id)}))}),a.bigtapDataType=i.uniqueArr(a.bigtapDataType)},uniqueArr:function(e){for(var t=[],i={},o=0;o<e.length;o++)i[e[o]]||(t.push(e[o]),i[e[o]]=1);return t},unique:function(e){for(var t=[e[0]],i=1,o=e.length;o>i;i++){for(var n=!1,s=0,r=t.length;r>s;s++)if(e[i].name===t[s].name&&e[i].level===t[s].level){n=!0;break}n||(t.push(e[i]),a.sortData.push(e[i].name))}return t},reloadFun:function(){var e=this;$(".J_reload").on("click",function(){$(".J_load").removeClass("hide"),$(".J_error").addClass("hide"),e.setAjaxInt()})},showError:function(e){$(".J_load").addClass("hide"),e=e?e:"有点小问题，请点击按钮刷新重试",$(".J_error").removeClass("hide").find("h3").html(e)},setAjaxInt:function(){var e=this;setTimeout(function(){i({url:e.config.orderSite+"/product/get2",data:{product_id:a.pid},jsonpCallback:"proget2callback",error:function(){e.showError()},callback:function(t){if(1===t.code){e.config.list=t.data,e.config.list.check_index=[{index:0,val:""},{index:0,val:""},{index:0,val:""}];var i=doT.template($("#J_addressTmp").html());a.need_address_check=t.data.need_address_check,e.config.list.isLogin=e.config.isLogin,e.config.list.href=e.config.loginUrl,e.addCart(),a.commodityIds=t.data.commodity_ids,""!==t.data.product_desc_ext&&$("#J_desc").html(t.data.product_desc_ext),""!==t.data.name&&(a.proName=t.data.name,$(".J_proName").html(a.proName)),e.loopGoodsList(0,e.config.list.list),a.allGoods=e.unique(a.allGoods),a.need_address_check?($(".J_addressWrap").eq(0).html(i()).removeClass("hide"),e.addressInit()):($(".J_addressWrap").eq(1).html(i()).removeClass("hide"),e.getGoodsStock("init"))}else e.showError(t.msg)}})},500),i({url:e.config.orderSite+"/product/getExtendInfo",data:{product_id:a.pid},callback:function(t){if(1===t.code&&(t=t.data,e.relation=t.relation,t.info&&t.info.desc_tabs_view&&t.info.desc_tabs_view[0])){tmp=doT.template($("#J_proInfoTmp").html()),
$("#J_proInfo").append(tmp(t.info.desc_tabs_view[0].tab_content)).find(".J_imgBox").each(function(){$(this).slider({auto:!0,pager:!0,infiniteLoop:!0})});var i=$(".section");i.visibleWatcher({onVisible:function(e,t){i.filter(function(e){return t+1>=e}).addClass("preload").find("img").each(function(){s($(this))})}})}}})},relationCallback:function(){var e=this,t="",i={cid:a.cid,data:e.relation};if(e.relation){if(0===e.relation.length)return void $("#J_relation").addClass("hide");$("#J_relation").removeClass("hide"),t=doT.template($("#J_relationTmp").html());var o=0;$("#J_relation").html(t(i)).find(".list").find("li").find("del").each(function(){o+=parseFloat($(this).data("maxsave"))}),o>0&&($(".J_saleMax").removeClass("hide"),$(".J_salePrice").html(o)),e.selectList($("#J_parts"),"parts"),e.selectList($("#J_install"),"install");var n=a.parts;a.parts=[],$.each(n,function(e,t){$("#J_relation").find(".list").find("li").eq(t.index).find("i").click().end().find("a").eq(t.item).click()})}},bookRuleModalFun:function(){$(".J_bookRule,.J_bookRuleCon").hover(function(){$(".J_bookRuleCon").removeClass("hide")},function(){$(".J_bookRuleCon").addClass("hide")})},init:function(){this.hideLoadNotic(),n(),this.reloadFun(),this.setAjaxInt(),setTimeout(function(){MI.proNav({id:window.proBuy_id,target:"buy"}),$(".J_proName").html(a.proName)},500),this.bookRuleModalFun()}},l={config:$.extend(t,e),getCoupon:function(){var e=this,t=function(e){$("#J_couponModal").find(".list").addClass("hide").end().find(".result").removeClass("hide").find(".con").addClass("hide").end().find(e).removeClass("hide")};$("body").on("click",".J_getCoupon",function(){if(!e.config.isLogin)return void(window.location.href=e.config.hdloginUrl);var o=$(this).data("actcode"),a=$(this).data("drawcode");i({url:e.config.hdUrl+"/activity/draw/draw/antiuid/123",data:{code:o,channel:"pc",activitytype:"draw",drawcode:a},callback:function(e){var i=e.code;return 0===i?void t(".succ"):20006===i||20007===i||20013===i||20014===i?void t(".over"):void t(".fail")}})}),$("body").on("click",".J_getCouponList",function(){return e.config.isLogin?void(a.coupon?e.getCouponList():($("#J_couponModal").modal("show"),a.coupon=!0)):void(window.location.href=e.config.hdloginUrl)}),$("body").on("click",".J_getCouponReturn",function(){e.getCouponList()})},getCouponList:function(){var e=this,t=$("#J_couponModal"),n=$(".J_couponWrap"),s=doT.template($("#J_couponListTmp").html());i({url:e.config.orderSite+"/product/coupon?commodity_ids="+a.commodityIds.join(","),jsonpcallback:"jsonp1",callback:function(e){if(1===e.code){if(a.couponData=e.data.can_apply_coupons,a.couponData&&0!==a.couponData.length){var i=0,r="",d="";for(var l in a.couponData)0===i&&(r=a.couponData[l].name),a.couponData[l].id=l,d+=s(a.couponData[l]),i++;i>1&&(r=r+"等"+i+"种优惠券"),n.removeClass("hide").find(".J_couponName").html(r),t.find(".list").removeClass("hide").end().find(".result").addClass("hide").end().find("ul").html(d).end().find(".no-coupon").remove(),a.coupon&&t.modal("show")}else n.addClass("hide"),t.find(".list").removeClass("hide").append('<p class="no-coupon">优惠券已经被领光了</p>').end().find(".result").addClass("hide").end().find("ul").html("");e.data.sync_login&&0===a.proxy&&o(function(){},e.data.sync_login)}}})},init:function(){this.getCouponList(),this.getCoupon()}},c={config:$.extend(t,e),orderAddress:function(){var e=this;$("body").on("click","#J_orderModal li",function(){a.orderAddressId=$(this).data("id"),$(this).addClass("active").siblings().removeClass("active"),i({url:e.config.orderSubmitUrl,data:{goods_id:a.id,address_id:a.orderAddressId},callback:function(e){1===e.code||2007===e.code?(MI.alert({msg:"预约成功",isConfirm:!1}),$("#J_orderModal").modal("hide"),$(".J_orderBtn").addClass("btn-disabled").html("已预约").removeClass("J_orderBtn"),a.orderData[a.id]=!0):MI.alert({msg:e.msg,isConfirm:!1})}})})},getAddresslist:function(){var e=this,t=doT.template($("#J_addressListTmp").html());i({url:e.config.addressListUrl,callback:function(i){if(1===i.code)$("#J_orderModal").modal("show").find(".tab").eq(0).attr("href",e.config.addAddressUrl).end().end().find(".address-wrap").html(t(i.data));else{if(-2===i.code)return void(location.href=e.config.loginUrl);MI.alert({msg:i.msg,isConfirm:!1})}}})},init:function(){var e=this;this.orderAddress(),$("body").on("click",".J_orderBtn",function(){e.getAddresslist()})}};d.init(),c.init()},$(document).ready(function(){$.productBuy({id:window.proBuy_id})})},function(e,t,i){i(3),MI.namespace("buyChooseAddress"),MI.buyChooseAddress={init:function(e){var t=this,i={isShowStreet:!0,showTrigger:"#J_switchChooseRegions",afterChoose:$.noop};t.options=$.extend(i,e),t.apiUrl={my:MI.GLOBAL_CONFIG.orderSite+"/address/getAddressList","default":MI.GLOBAL_CONFIG.orderSite+"/address/getDefaultAddress",search:MI.GLOBAL_CONFIG.orderSite+"/address/searchByKeywords",translate:MI.GLOBAL_CONFIG.orderSite+"/address/getAreaInfoByLocation",save:MI.GLOBAL_CONFIG.orderSite+"/address/setDefaultAddress",login:MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href},t.$userDefault=$("#J_userDefaultAddress"),t.$input=$("#J_searchRegionsInput"),t.$inputClear=$("#J_searchRegionsInputClear"),t.$searchWrapper=$("#J_searchAddressWrapper"),t.$loading=t.$searchWrapper.find(".loading"),t.$myAddr=t.$searchWrapper.find("#J_myAddress"),t.$myAddrList=t.$myAddr.find(".list"),t.$noLogin=t.$myAddr.find("#J_noLogin"),t.$nearbyAddr=t.$searchWrapper.find("#J_nearbyAddress"),t.$nearbyAddrList=t.$nearbyAddr.find(".list"),t.$searchAddr=t.$searchWrapper.find("#J_searchAdress"),t.$searchAddrList=t.$searchAddr.find(".list"),t.$noResult=t.$searchWrapper.find("#J_noSearchResult"),t.searchVal=null,t.nearbyData=null,t.myData=null,t.$noLogin.find("a").attr("href",t.apiUrl.login),t.selectAddress=new MI.fourAddress,t.selectAddress.init({selectEnd:function(e){t.formatChooseResult(e)}}),t.checkLogin(),t.searchEvent(),t.selectEvent(),t.switchType(),t.getDefaultAddress(),t.showChooseRegions()},showChooseRegions:function(){var e=this,t=$("#J_modalChooseRegions");$(e.options.showTrigger).on("click",function(){var i=e.$userDefault.offset();$(window).scrollTop()+$(window).height()<i.top+t.height()&&(i.top-=t.height(),i.top+=$("#J_userDefaultAddress").height()),t.css({top:i.top,left:i.left}).modal("show").one("hidden",function(){e.revert()}),e.getMyAddress()})},checkLogin:function(){this.isLogin=$.cookie("cUserId")?!0:!1},revert:function(){this.$input.val(""),this.searchVal=null,this.toggleShow(this.$myAddr,!0),this.toggleShow(this.$nearbyAddr,!1),this.toggleShow(this.$searchAddr,!1),this.toggleShow(this.$noResult,!1)},searchEvent:function(){var e,t,i=this,o=200;i.$input.on({focus:function(){i.toggleShow(i.$myAddr,!1),i.toggleShow(i.$loading,!0),i.searchVal?i.searchAddress():i.nearbyData?i.formatAddress(i.nearbyData,null,"nearby"):i.searchAddress()},blur:function(){t&&clearTimeout(t),t=setTimeout(function(){i.toggleShow(i.$nearbyAddr,!1),i.toggleShow(i.$searchAddr,!1),i.toggleShow(i.$noResult,!1),i.toggleShow(i.$myAddr,!0),$(".J_switchTypeTrigger").eq(0).show()},200)},keyup:function(){e&&clearTimeout(e),e=setTimeout(function(){i.searchVal=$.trim(i.$input.val().replace(/[\-_'=+|\\\/]/g," ")),i.searchVal?i.toggleShow(i.$inputClear,!0):i.toggleShow(i.$inputClear,!1),i.toggleShow(i.$myAddr,!1),i.toggleShow(i.$nearbyAddr,!1),i.toggleShow(i.$searchAddr,!1),i.toggleShow(i.$noResult,!1),i.toggleShow(i.$loading,!0),i.searchAddress()},o)}}),i.$inputClear.on("click",function(){i.searchVal=null,i.$input.val("").focus(),i.toggleShow(i.$inputClear,!1)})},selectEvent:function(){var e=this;e.$myAddrList.on("click",".J_addrItem",function(){var t=$(this).index();e.myData[t].address_id={id:$(this).data("id")},delete e.myData[t].consignee,e.formatChooseResult(e.myData[t])}),$.each([e.$nearbyAddrList,e.$searchAddrList],function(t,i){i.on("click",".J_addrItem",function(){var t=$(this).attr("data-code"),i=$(this).attr("data-location");e.translateSearchResult({code:t,location:i})})})},toggleShow:function(e,t){t?e.removeClass("hide"):e.addClass("hide")},switchType:function(){$(".J_switchTypeTrigger").on("click",function(){var e=$(this).attr("data-type");e&&$(".J_chooseRegionsBox[data-type="+e+"]").removeClass("hide").siblings(".J_chooseRegionsBox").addClass("hide")})},getDefaultAddress:function(){var e=this,t={url:e.apiUrl["default"],dataType:"jsonp",jsonp:"jsonpcallback",timeout:3e4,cache:!0,error:function(){},success:function(t){t&&1===t.code&&e.formatChooseResult(t.data,!0)}};window.ref_goods&&(t.data={},t.data.ref_goods=window.ref_goods),$.ajax(t)},getMyAddress:function(){var e=this;return e.isLogin?void(e.myData||$.ajax({url:e.apiUrl.my,dataType:"jsonp",jsonp:"jsonpcallback",timeout:3e4,cache:!0,error:function(){},success:function(t){t&&1===t.code?(e.myData=t.data,e.formatAddress(t.data,e.myAddressPage,"my")):-2===t.code&&(e.toggleShow(e.$loading,!1),e.toggleShow(e.$myAddr,!0))}})):(e.toggleShow(e.$loading,!1),void e.toggleShow(e.$myAddr,!0))},searchAddress:function(){var e=this,t=e.searchVal?"search":"nearby";$.ajax({url:e.apiUrl.search,dataType:"jsonp",jsonp:"jsonpcallback",data:{keywords:e.searchVal},timeout:3e4,cache:!0,error:function(){},success:function(i){if(i&&1===i.code){if(!i.data||!i.data.length)return e.toggleShow(e.$loading,!1),void("search"===t&&(e.toggleShow(e.$noResult,!0),$(".J_switchTypeTrigger").eq(0).hide()));e.searchVal||(e.nearbyData=i.data),e.formatAddress(i.data.slice(0,5),null,t)}}})},formatAddress:function(e,t,i){if(e){var o=this,a=multiline(function(){/*!@tpl
	        {{~it :value:index}}
	            <li class="J_addrItem" data-id="{{=value.address_id}}">
	                <div class="address-title">
	                    <span class="item">{{=value.consignee}}</span>
	                    <span class="item">{{=value.province.name}}</span>
	                </div>
	                <div class="address-desc">
	                    {{=value.city.name}}{{=value.district.name}}{{=value.area.name}}
	                </div>
	            </li>
	        {{~}}
	        */
console.log()}),n=multiline(function(){/*!@tpl
	        {{~it :value:index}}
	            <li class="J_addrItem" data-code="{{=value.adcode ? value.adcode : ''}}"
	            data-location="{{=value.location}}" data-id="{{=value.address_id}}">
	                <div class="address-title">
	                    <span class="item">{{=value.name}}</span>
	                </div>
	                <div class="address-desc">
	                    {{=value.pname}}{{=value.cityname}}{{=value.adname}}
	                </div>
	                <a class="btn btn-primary">选择</a>
	            </li>
	        {{~}}
	        */
console.log()}),s="";o.toggleShow(o.$loading,!1),o.toggleShow(o.$myAddr,!1),o.toggleShow(o.$noResult,!1),i&&"my"===i?(s=doT.template(a)(e),o.$myAddrList.html(s),o.toggleShow(o.$noLogin,!1),o.toggleShow(o.$myAddr,!0)):"nearby"===i?(s=doT.template(n)(e),o.$nearbyAddrList.html(s),o.toggleShow(o.$nearbyAddr,!0)):"search"===i&&(s=doT.template(n)(e),o.$searchAddrList.html(s),o.toggleShow(o.$searchAddr,!0)),"function"==typeof t&&$.proxy(t,o)()}},myAddressPage:function(){function e(){a.$myAddrList.css({"margin-top":p*(l-1)*-1+"px"}),o.text(l)}var t,i,o,a=this,n=a.$myAddrList.find(".J_addrItem"),s=n.length,r=4,d=s%r>0?parseInt(s/r)+1:s/r,l=1,c=multiline(function(){/*!@tpl
	          <div class="page-controller">
	              <a href="javascript:void(0);" class="iconfont page-prev">&#xe629;</a>
	              <span class="page-num"><i class="curr">{{=it.curr}}</i> / <i class="total">{{=it.total}}</i></span>
	              <a href="javascript:void(0);" class="iconfont page-next">&#xe624;</a>
	          </div>
	        */
console.log()}),h="",p=2*n.outerHeight();1>=d||(a.$myAddrList.parent().css({height:p,overflow:"hidden"}),h=doT.template(c)({curr:l,total:d}),a.$myAddr.append(h),o=a.$myAddr.find(".curr"),i=a.$myAddr.find(".page-next"),t=a.$myAddr.find(".page-prev"),t.on("click",function(){l>1&&(l-=1),e()}),i.on("click",function(){d>l&&(l+=1),e()}))},translateSearchResult:function(e){var t=this;$.ajax({url:t.apiUrl.translate,dataType:"jsonp",jsonp:"jsonpcallback",data:{adcode:e.code,location:e.location},timeout:3e4,error:function(){},success:function(e){e&&1===e.code&&t.formatChooseResult(e.data)}})},isjson:function(e){return"object"!=typeof e||"[object object]"!==Object.prototype.toString.call(e).toLowerCase()||e.length?!1:!0},formatChooseResult:function(e,t){var i=this,o="",a=[],n="";$.each(e,function(e,t){"mihome_id"===e?(n=t,i.options.mihomeId=t):"address_id"===e?a.push({id:t.id}):i.isjson(t)&&a.push({id:t.id,name:t.name})}),t||i.saveResult(a),$.each(a,function(e,t){!i.options.isShowStreet&&e>=4||t.name&&(o+='<span class="item">'+t.name+"</span>")}),i.$userDefault.removeClass("hide").find(".address-info").html(o),"function"==typeof i.options.afterChoose&&i.options.afterChoose(a,n)},saveResult:function(e){var t=this,i={};i=e.length>4?{address_id:{id:e[0].id||""},province:{id:e[1].id,name:e[1].name},city:{id:e[2].id,name:e[2].name},district:{id:e[3].id,name:e[3].name},area:{id:e[4].id,name:e[4].name}}:{province:{id:e[0].id,name:e[0].name},city:{id:e[1].id,name:e[1].name},district:{id:e[2].id,name:e[2].name},area:{id:e[3].id,name:e[3].name}},$.ajax({url:t.apiUrl.save,dataType:"jsonp",jsonp:"jsonpcallback",data:{address:i},timeout:3e4,error:function(){},success:function(){}})}}},function(e,t){MI.namespace("fourAddress"),MI.fourAddress=function(){this.options={wrapperElm:"#J_selectAddressWrapper",optionsWrapper:".J_optionsWrapper",selectWrapper:"#J_selectWrapper",maxLevel:4,afterFormat:$.noop,selectEnd:$.noop}},MI.fourAddress.prototype={constructor:MI.fourAddress,init:function(e){var t=this;"object"==typeof e&&(t.options=$.extend(t.options,e)),t.$wrapper=$(t.options.wrapperElm),t.$wrapper.length&&(t.addrUrl="//s1.mi.com/open/common/js/address_all_new.js?v=7930814",t.addressData=[],t.addrTemp=multiline(function(){/*!@tpl
	          <div class="select-box clearfix" id="J_selectWrapper">
	              <div class="select-first select-item J_select" data-init-txt="选择省份/自治区">选择省份/自治区</div>
	              <div class="select-item J_select hide" data-init-txt="选择城市/地区"></div>
	              <div class="select-item J_select hide" data-init-txt="选择区县"></div>
	              <div class="select-last select-item J_select hide" data-init-txt="选择配送区域"></div>
	          </div>

	          <div class="options-box">
	              <ul class="options-list J_optionsWrapper clearfix">
	                  {{~it :value:index}}
	                      <li class="option J_option"
	                      data-value="{{=value.id}}"
	                      data-txt="{{=value.name}}">{{=value.name}}
	                      </li>
	                  {{~}}
	              </ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	          </div>
	        */
console.log()}),t.optionTemp=multiline(function(){/*!@tpl
	          {{~it :value:index}}
	            {{? value.region_id}}
	            <li class="J_option" data-txt="{{=value.region_name}}" data-value="{{=value.region_id}}">
	            {{=value.region_name}}</li>
	            {{?? }}
	            <li class="J_option" data-txt="{{=value.name}}" data-value="{{=value.id}}"
	            data-zipcode="{{=value.zipcode ? value.zipcode : ''}}">{{=value.name}}</li>
	            {{? }}
	          {{~}}
	        */
console.log()}),t.result={},t.lastLevel=t.options.maxLevel-1,t.getAllRegions())},getAllRegions:function(){var e=this;$.ajax({url:e.addrUrl,dataType:"script",cache:!0,timeout:3e4,error:function(){},success:function(){"undefined"!=typeof window.data&&(e.addressData=window.data),e.formatRegions()}})},formatRegions:function(){var e=this,t=doT.template(e.addrTemp),i=t(e.addressData);e.$wrapper.html(i),e.$optionsWrapper=e.$wrapper.find(e.options.optionsWrapper),e.$selectWrapper=e.$wrapper.find(e.options.selectWrapper),e.selectEvent(),"function"==typeof e.options.afterFormat&&e.options.afterFormat()},selectEvent:function(){var e=this,t=0;e.$selectWrapper.on("click.seladdr",".J_select",function(){var i=$(this).addClass("active"),o=$(this).attr("data-init-txt");i&&(t=$(this).index(),e.$selectWrapper.find(".J_select:gt("+t+")").addClass("hide").removeClass("active"),e.$optionsWrapper.addClass("hide").eq(t).removeClass("hide"),$(this).html(o).removeClass("active"))}),e.$optionsWrapper.on("click.seladdr",".J_option",function(){var i=parseInt($(this).attr("data-value")),o=$(this).attr("data-txt"),a=$(this).attr("data-zipcode")||"",n=t+1,s=e.$selectWrapper.find(".J_select").eq(n);return e.result[t]={id:i,name:o,zcode:a},e.$selectWrapper.find(".J_select").eq(t).html(o).addClass("active"),t===e.lastLevel?void("function"==typeof e.options.selectEnd&&e.options.selectEnd(e.result)):(t+=1,n>=e.lastLevel?e.getLastLevelData():e.formatNextLevelOption(i,n),void(s.length&&s.html(s.attr("data-init-txt")).removeClass("hide")))})},getAddressLevelData:function(e){var t=[],i=this;return $.each(i.addressData,function(i,o){return o.id===e?(t=o.child,!1):void(o.child&&$.each(o.child,function(i,o){return o.id===e?(t=o.child,!1):void(o.child&&$.each(o.child,function(i,o){return o.id===e?(t=o.tags,!1):void 0}))}))}),t},formatNextLevelOption:function(e,t){if(e){var i=this,o=i.getAddressLevelData(e,t),a=i.formatOption(o);i.$optionsWrapper.addClass("hide").eq(t).html(a).removeClass("hide"),1===o.length&&setTimeout(function(){i.$optionsWrapper.eq(t).find(".J_option").eq(0).trigger("click")},50)}},getLastLevelData:function(){var e=this,t=MI.GLOBAL_CONFIG.orderSite+"/api/getAddressRegion.php";e.$optionsWrapper.addClass("hide").eq(e.lastLevel).html('<div class="loading"><div class="loader"></div></div>').removeClass("hide"),$.ajax({url:t,dataType:"jsonp",jsonp:"jsonpcallback",data:{parent:e.result[2].id},tiemout:3e4,error:function(){},success:function(t){if(t&&t.data.regions){var i=[];$.each(t.data.regions,function(e,t){i.push(t)});var o=e.formatOption(i);e.$optionsWrapper.eq(e.lastLevel).html(o)}}})},formatOption:function(e){var t=this,i="";return e?i=doT.template(t.optionTemp)(e):void 0},getResult:function(){return this.result}}},function(e,t){!function(e){function t(t){function i(){for(var t=-1,i=e(document).scrollTop(),o=0,a=l.length;a>o&&i+s.viewport.height()>l[o];o+=1)t+=1;return t}function o(){var t=i();d!==t&&(d=t,r.filter(function(t){return d>=t&&!e(this).hasClass(s.visibleClass)}).addClass(s.visibleClass).trigger("visible.visibleWatcher"),s.onVisible(r.eq(d),d))}function a(){r.each(function(){var t=e(this).attr("data-offset")?Number(e(this).attr("data-offset")):s.offset,i=t%1===0?t:t*s.viewport.height();l.push(e(this).offset().top+i)}),o(),s.onLoad()}var n,s,r=e(this),d=-1,l=[];n={viewport:e(window),visibleClass:"is-visible",offset:300,onLoad:e.noop,onVisible:e.noop},s=e.extend({},n,t),a(),s.viewport.on({"scroll.visibleWatcher":o,"resize.visibleWatcher":a})}e.fn.visibleWatcher=function(e){return t.call(this,e),this}}(jQuery)},function(e,t){!function(e){var t={},o={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,video:!1,useCSS:!0,preloadImages:"visible",responsive:!0,slideZIndex:50,wrapperClass:"ui-wrapper",touchEnabled:!0,swipeThreshold:50,oneToOneTouch:!0,preventDefaultSwipeX:!0,preventDefaultSwipeY:!1,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,nextText:"下一张",prevText:"上一张",nextSelector:null,prevSelector:null,autoControls:!1,startText:"开始",stopText:"停止",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4e3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,autoSlideForOnePage:!1,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:e.noop,onSlideBefore:e.noop,onSlideAfter:e.noop,onSlideNext:e.noop,onSlidePrev:e.noop,onSliderResize:e.noop};e.fn.slider=function(a){if(0==this.length)return this;if(this.length>1)return this.each(function(){e(this).slider(a)}),this;var n={},s=this;t.el=this;var r=e(window).width(),d=e(window).height(),l=function(){n.settings=e.extend({},o,a),n.settings.slideWidth=parseInt(n.settings.slideWidth),n.children=s.children(n.settings.slideSelector),n.children.length<n.settings.minSlides&&(n.settings.minSlides=n.children.length),n.children.length<n.settings.maxSlides&&(n.settings.maxSlides=n.children.length),n.settings.randomStart&&(n.settings.startSlide=Math.floor(Math.random()*n.children.length)),n.active={index:n.settings.startSlide},n.carousel=n.settings.minSlides>1||n.settings.maxSlides>1,n.carousel&&(n.settings.preloadImages="all"),n.minThreshold=n.settings.minSlides*n.settings.slideWidth+(n.settings.minSlides-1)*n.settings.slideMargin,n.maxThreshold=n.settings.maxSlides*n.settings.slideWidth+(n.settings.maxSlides-1)*n.settings.slideMargin,n.working=!1,n.controls={},n.interval=null,n.animProp="vertical"==n.settings.mode?"top":"left",n.usingCSS=n.settings.useCSS&&"fade"!=n.settings.mode&&function(){var e=document.createElement("div"),t=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var i in t)if(void 0!==e.style[t[i]])return n.cssPrefix=t[i].replace("Perspective","").toLowerCase(),n.animProp="-"+n.cssPrefix+"-transform",!0;return!1}(),"vertical"==n.settings.mode&&(n.settings.maxSlides=n.settings.minSlides),s.data("origStyle",s.attr("style")),s.children(n.settings.slideSelector).each(function(){e(this).data("origStyle",e(this).attr("style"))}),c()},c=function(){s.wrap('<div class="'+n.settings.wrapperClass+'"><div class="ui-viewport"></div></div>'),n.viewport=s.parent(),n.loader=e('<div class="ui-loading" />'),n.viewport.prepend(n.loader),s.css({width:"horizontal"==n.settings.mode?100*n.children.length+215+"%":"auto",position:"relative"}),n.usingCSS&&n.settings.easing?s.css("-"+n.cssPrefix+"-transition-timing-function",n.settings.easing):n.settings.easing||(n.settings.easing="swing");m();n.viewport.css({width:"100%",overflow:"hidden",position:"relative"}),n.viewport.parent().css({maxWidth:u()}),n.settings.pager||n.viewport.parent().css({margin:"0 auto 0px"}),n.children.css({"float":"horizontal"==n.settings.mode?"left":"none",listStyle:"none",position:"relative"}),n.children.css("width",f()),"horizontal"==n.settings.mode&&n.settings.slideMargin>0&&n.children.css("marginRight",n.settings.slideMargin),"vertical"==n.settings.mode&&n.settings.slideMargin>0&&n.children.css("marginBottom",n.settings.slideMargin),"fade"==n.settings.mode&&(n.children.css({position:"absolute",zIndex:0,display:"none"}),n.children.eq(n.settings.startSlide).css({zIndex:n.settings.slideZIndex,display:"block"})),n.controls.el=e('<div class="ui-controls" />'),n.settings.captions&&S(),n.active.last=n.settings.startSlide==v()-1,n.settings.video&&s.fitVids();var t=n.children.eq(n.settings.startSlide);"all"==n.settings.preloadImages&&(t=n.children),n.settings.ticker?n.settings.pager=!1:(n.settings.pager&&w(),n.settings.controls&&k(),n.settings.auto&&n.settings.autoControls&&x(),(n.settings.controls||n.settings.autoControls||n.settings.pager)&&n.viewport.after(n.controls.el)),h(t,p)},h=function(t,i){var o=t.find("img, iframe").length;if(0==o)return void i();var a=0;t.find("img, iframe").each(function(){e(this).one("load",function(){++a==o&&i()}).each(function(){this.complete&&e(this).load()})})},p=function(){if(n.settings.infiniteLoop&&"fade"!=n.settings.mode&&!n.settings.ticker){var t="vertical"==n.settings.mode?n.settings.minSlides:n.settings.maxSlides,i=n.children.slice(0,t).clone().addClass("ui-clone"),o=n.children.slice(-t).clone().addClass("ui-clone");s.append(i).prepend(o)}n.loader.remove(),_(),"vertical"==n.settings.mode&&(n.settings.adaptiveHeight=!0),n.viewport.height(g()),s.redrawSlider(),n.settings.onSliderLoad(n.active.index),n.initialized=!0,n.settings.responsive&&e(window).bind("resize",O),n.settings.auto&&n.settings.autoStart&&(v()>1||n.settings.autoSlideForOnePage)&&P(),n.settings.ticker&&j(),n.settings.pager&&A(n.settings.startSlide),n.settings.controls&&M(),n.settings.touchEnabled&&!n.settings.ticker&&F()},g=function(){var t=0,o=e();if("vertical"==n.settings.mode||n.settings.adaptiveHeight)if(n.carousel){var a=1==n.settings.moveSlides?n.active.index:n.active.index*b();for(o=n.children.eq(a),i=1;i<=n.settings.maxSlides-1;i++)o=o.add(a+i>=n.children.length?n.children.eq(i-1):n.children.eq(a+i))}else o=n.children.eq(n.active.index);else o=n.children;return"vertical"==n.settings.mode?(o.each(function(i){t+=e(this).outerHeight()}),n.settings.slideMargin>0&&(t+=n.settings.slideMargin*(n.settings.minSlides-1))):t=Math.max.apply(Math,o.map(function(){return e(this).outerHeight(!1)}).get()),"border-box"==n.viewport.css("box-sizing")?t+=parseFloat(n.viewport.css("padding-top"))+parseFloat(n.viewport.css("padding-bottom"))+parseFloat(n.viewport.css("border-top-width"))+parseFloat(n.viewport.css("border-bottom-width")):"padding-box"==n.viewport.css("box-sizing")&&(t+=parseFloat(n.viewport.css("padding-top"))+parseFloat(n.viewport.css("padding-bottom"))),t},u=function(){var e="100%";return n.settings.slideWidth>0&&(e="horizontal"==n.settings.mode?n.settings.maxSlides*n.settings.slideWidth+(n.settings.maxSlides-1)*n.settings.slideMargin:n.settings.slideWidth),e},f=function(){var e=n.settings.slideWidth,t=n.viewport.width();return 0==n.settings.slideWidth||n.settings.slideWidth>t&&!n.carousel||"vertical"==n.settings.mode?e=t:n.settings.maxSlides>1&&"horizontal"==n.settings.mode&&(t>n.maxThreshold||t<n.minThreshold&&(e=(t-n.settings.slideMargin*(n.settings.minSlides-1))/n.settings.minSlides)),e},m=function(){var e=1;if("horizontal"==n.settings.mode&&n.settings.slideWidth>0)if(n.viewport.width()<n.minThreshold)e=n.settings.minSlides;else if(n.viewport.width()>n.maxThreshold)e=n.settings.maxSlides;else{var t=n.children.first().width()+n.settings.slideMargin;e=Math.floor((n.viewport.width()+n.settings.slideMargin)/t)}else"vertical"==n.settings.mode&&(e=n.settings.minSlides);return e},v=function(){var e=0;if(n.settings.moveSlides>0)if(n.settings.infiniteLoop)e=Math.ceil(n.children.length/b());else for(var t=0,i=0;t<n.children.length;)++e,t=i+m(),i+=n.settings.moveSlides<=m()?n.settings.moveSlides:m();else e=Math.ceil(n.children.length/m());return e},b=function(){return n.settings.moveSlides>0&&n.settings.moveSlides<=m()?n.settings.moveSlides:m()},_=function(){if(n.children.length>n.settings.maxSlides&&n.active.last&&!n.settings.infiniteLoop){if("horizontal"==n.settings.mode){var e=n.children.last(),t=e.position();$(-(t.left-(n.viewport.width()-e.outerWidth())),"reset",0)}else if("vertical"==n.settings.mode){var i=n.children.length-n.settings.minSlides,t=n.children.eq(i).position();$(-t.top,"reset",0)}}else{var t=n.children.eq(n.active.index*b()).position();n.active.index==v()-1&&(n.active.last=!0),void 0!=t&&("horizontal"==n.settings.mode?$(-t.left,"reset",0):"vertical"==n.settings.mode&&$(-t.top,"reset",0))}},$=function(e,t,i,o){if(n.usingCSS){var a="vertical"==n.settings.mode?"translate3d(0, "+e+"px, 0)":"translate3d("+e+"px, 0, 0)";s.css("-"+n.cssPrefix+"-transition-duration",i/1e3+"s"),"slide"==t?(s.css(n.animProp,a),s.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){s.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),I()})):"reset"==t?s.css(n.animProp,a):"ticker"==t&&(s.css("-"+n.cssPrefix+"-transition-timing-function","linear"),s.css(n.animProp,a),s.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){s.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),$(o.resetValue,"reset",0),E()}))}else{var r={};r[n.animProp]=e,"slide"==t?s.animate(r,i,n.settings.easing,function(){I()}):"reset"==t?s.css(n.animProp,e):"ticker"==t&&s.animate(r,speed,"linear",function(){$(o.resetValue,"reset",0),E()})}},y=function(){for(var t="",i=v(),o=0;i>o;o++){var a="";n.settings.buildPager&&e.isFunction(n.settings.buildPager)?(a=n.settings.buildPager(o),n.pagerEl.addClass("ui-custom-pager")):(a=o+1,n.pagerEl.addClass("ui-default-pager")),t+='<div class="ui-pager-item"><a href="" data-slide-index="'+o+'" class="ui-pager-link">'+a+"</a></div>"}n.pagerEl.html(t)},w=function(){n.settings.pagerCustom?n.pagerEl=e(n.settings.pagerCustom):(n.pagerEl=e('<div class="ui-pager" />'),n.settings.pagerSelector?e(n.settings.pagerSelector).html(n.pagerEl):n.controls.el.addClass("ui-has-pager").append(n.pagerEl),y()),n.pagerEl.on("click","a",B)},k=function(){n.controls.next=e('<a class="ui-next" href="">'+n.settings.nextText+"</a>"),n.controls.prev=e('<a class="ui-prev" href="">'+n.settings.prevText+"</a>"),n.controls.next.bind("click",C),n.controls.prev.bind("click",T),n.settings.nextSelector&&e(n.settings.nextSelector).append(n.controls.next),n.settings.prevSelector&&e(n.settings.prevSelector).append(n.controls.prev),n.settings.nextSelector||n.settings.prevSelector||(n.controls.directionEl=e('<div class="ui-controls-direction" />'),n.controls.directionEl.append(n.controls.prev).append(n.controls.next),n.controls.el.addClass("ui-has-controls-direction").append(n.controls.directionEl))},x=function(){n.controls.start=e('<div class="ui-controls-auto-item"><a class="ui-start" href="">'+n.settings.startText+"</a></div>"),n.controls.stop=e('<div class="ui-controls-auto-item"><a class="ui-stop" href="">'+n.settings.stopText+"</a></div>"),n.controls.autoEl=e('<div class="ui-controls-auto" />'),n.controls.autoEl.on("click",".ui-start",J),n.controls.autoEl.on("click",".ui-stop",D),n.settings.autoControlsCombine?n.controls.autoEl.append(n.controls.start):n.controls.autoEl.append(n.controls.start).append(n.controls.stop),n.settings.autoControlsSelector?e(n.settings.autoControlsSelector).html(n.controls.autoEl):n.controls.el.addClass("ui-has-controls-auto").append(n.controls.autoEl),L(n.settings.autoStart?"stop":"start")},S=function(){n.children.each(function(t){var i=e(this).find("img:first").attr("title");void 0!=i&&(""+i).length&&e(this).append('<div class="ui-caption"><span>'+i+"</span></div>")})},C=function(e){n.settings.auto&&s.stopAuto(),s.goToNextSlide(),e.preventDefault()},T=function(e){n.settings.auto&&s.stopAuto(),s.goToPrevSlide(),e.preventDefault()},J=function(e){s.startAuto(),e.preventDefault()},D=function(e){s.stopAuto(),e.preventDefault()},B=function(t){var i=e(t.currentTarget);if(void 0!==i.attr("data-slide-index")){var o=parseInt(i.attr("data-slide-index"));o!=n.active.index&&(n.settings.auto&&s.stopAuto(),s.goToSlide(o)),t.preventDefault()}},A=function(t){var i=n.children.length;return"short"==n.settings.pagerType?(n.settings.maxSlides>1&&(i=Math.ceil(n.children.length/n.settings.maxSlides)),void n.pagerEl.html(t+1+n.settings.pagerShortSeparator+i)):(n.pagerEl.find("a").removeClass("active"),void n.pagerEl.each(function(i,o){e(o).find("a").eq(t).addClass("active")}))},I=function(){if(n.settings.infiniteLoop){var e="";0==n.active.index?e=n.children.eq(0).position():n.active.index==v()-1&&n.carousel?e=n.children.eq((v()-1)*b()).position():n.active.index==n.children.length-1&&(e=n.children.eq(n.children.length-1).position()),e&&("horizontal"==n.settings.mode?$(-e.left,"reset",0):"vertical"==n.settings.mode&&$(-e.top,"reset",0))}n.working=!1,n.settings.onSlideAfter(n.children.eq(n.active.index),n.oldIndex,n.active.index)},L=function(e){n.settings.autoControlsCombine?n.controls.autoEl.html(n.controls[e]):(n.controls.autoEl.find("a").removeClass("active"),n.controls.autoEl.find("a:not(.ui-"+e+")").addClass("active"))},M=function(){1==v()?(n.controls.prev.addClass("disabled"),n.controls.next.addClass("disabled")):!n.settings.infiniteLoop&&n.settings.hideControlOnEnd&&(0==n.active.index?(n.controls.prev.addClass("disabled"),n.controls.next.removeClass("disabled")):n.active.index==v()-1?(n.controls.next.addClass("disabled"),n.controls.prev.removeClass("disabled")):(n.controls.prev.removeClass("disabled"),n.controls.next.removeClass("disabled")))},P=function(){if(n.settings.autoDelay>0){setTimeout(s.startAuto,n.settings.autoDelay)}else s.startAuto();n.settings.autoHover&&s.hover(function(){n.interval&&(s.stopAuto(!0),n.autoPaused=!0)},function(){n.autoPaused&&(s.startAuto(!0),n.autoPaused=null)})},j=function(){var t=0;if("next"==n.settings.autoDirection)s.append(n.children.clone().addClass("ui-clone"));else{s.prepend(n.children.clone().addClass("ui-clone"));var i=n.children.first().position();t="horizontal"==n.settings.mode?-i.left:-i.top}$(t,"reset",0),n.settings.pager=!1,n.settings.controls=!1,n.settings.autoControls=!1,n.settings.tickerHover&&!n.usingCSS&&n.viewport.hover(function(){s.stop()},function(){var t=0;n.children.each(function(i){t+="horizontal"==n.settings.mode?e(this).outerWidth(!0):e(this).outerHeight(!0)});var i=n.settings.speed/t,o="horizontal"==n.settings.mode?"left":"top",a=i*(t-Math.abs(parseInt(s.css(o))));E(a)}),E()},E=function(e){speed=e?e:n.settings.speed;var t={left:0,top:0},i={left:0,top:0};"next"==n.settings.autoDirection?t=s.find(".ui-clone").first().position():i=n.children.first().position();var o="horizontal"==n.settings.mode?-t.left:-t.top,a="horizontal"==n.settings.mode?-i.left:-i.top,r={resetValue:a};$(o,"ticker",speed,r)},F=function(){n.touch={start:{x:0,y:0},end:{x:0,y:0}},n.viewport.bind("touchstart",R)},R=function(e){if(n.working)e.preventDefault();else{n.touch.originalPos=s.position();var t=e.originalEvent;n.touch.start.x=t.changedTouches[0].pageX,n.touch.start.y=t.changedTouches[0].pageY,n.viewport.bind("touchmove",W),n.viewport.bind("touchend",G)}},W=function(e){var t=e.originalEvent,i=Math.abs(t.changedTouches[0].pageX-n.touch.start.x),o=Math.abs(t.changedTouches[0].pageY-n.touch.start.y);if(3*i>o&&n.settings.preventDefaultSwipeX?e.preventDefault():3*o>i&&n.settings.preventDefaultSwipeY&&e.preventDefault(),"fade"!=n.settings.mode&&n.settings.oneToOneTouch){var a=0;if("horizontal"==n.settings.mode){var s=t.changedTouches[0].pageX-n.touch.start.x;a=n.touch.originalPos.left+s}else{var s=t.changedTouches[0].pageY-n.touch.start.y;a=n.touch.originalPos.top+s}$(a,"reset",0)}},G=function(e){n.viewport.unbind("touchmove",W);var t=e.originalEvent,i=0;if(n.touch.end.x=t.changedTouches[0].pageX,n.touch.end.y=t.changedTouches[0].pageY,"fade"==n.settings.mode){var o=Math.abs(n.touch.start.x-n.touch.end.x);o>=n.settings.swipeThreshold&&(n.touch.start.x>n.touch.end.x?s.goToNextSlide():s.goToPrevSlide(),s.stopAuto())}else{var o=0;"horizontal"==n.settings.mode?(o=n.touch.end.x-n.touch.start.x,i=n.touch.originalPos.left):(o=n.touch.end.y-n.touch.start.y,i=n.touch.originalPos.top),!n.settings.infiniteLoop&&(0==n.active.index&&o>0||n.active.last&&0>o)?$(i,"reset",200):Math.abs(o)>=n.settings.swipeThreshold?(0>o?s.goToNextSlide():s.goToPrevSlide(),s.stopAuto()):$(i,"reset",200)}n.viewport.unbind("touchend",G)},O=function(t){if(n.initialized){var i=e(window).width(),o=e(window).height();(r!=i||d!=o)&&(r=i,d=o,s.redrawSlider(),n.settings.onSliderResize.call(s,n.active.index))}};return s.goToSlide=function(t,i){if(!n.working&&n.active.index!=t){if(n.working=!0,n.oldIndex=n.active.index,n.active.index=0>t?v()-1:t>=v()?0:t,n.settings.onSlideBefore(n.children.eq(n.active.index),n.oldIndex,n.active.index),"next"==i?n.settings.onSlideNext(n.children.eq(n.active.index),n.oldIndex,n.active.index):"prev"==i&&n.settings.onSlidePrev(n.children.eq(n.active.index),n.oldIndex,n.active.index),n.active.last=n.active.index>=v()-1,n.settings.pager&&A(n.active.index),n.settings.controls&&M(),"fade"==n.settings.mode)n.settings.adaptiveHeight&&n.viewport.height()!=g()&&n.viewport.animate({height:g()},n.settings.adaptiveHeightSpeed),n.children.filter(":visible").fadeOut(n.settings.speed).css({zIndex:0}),n.children.eq(n.active.index).css("zIndex",n.settings.slideZIndex+1).fadeIn(n.settings.speed,function(){e(this).css("zIndex",n.settings.slideZIndex),I()});else{n.settings.adaptiveHeight&&n.viewport.height()!=g()&&n.viewport.animate({height:g()},n.settings.adaptiveHeightSpeed);var o=0,a={left:0,top:0};if(!n.settings.infiniteLoop&&n.carousel&&n.active.last)if("horizontal"==n.settings.mode){var r=n.children.eq(n.children.length-1);a=r.position(),o=n.viewport.width()-r.outerWidth()}else{var d=n.children.length-n.settings.minSlides;a=n.children.eq(d).position()}else if(n.carousel&&n.active.last&&"prev"==i){var l=1==n.settings.moveSlides?n.settings.maxSlides-b():(v()-1)*b()-(n.children.length-n.settings.maxSlides),r=s.children(".ui-clone").eq(l);a=r.position()}else if("next"==i&&0==n.active.index)a=s.find("> .ui-clone").eq(n.settings.maxSlides).position(),n.active.last=!1;else if(t>=0){var c=t*b();a=n.children.eq(c).position()}if("undefined"!=typeof a){var h="horizontal"==n.settings.mode?-(a.left-o):-a.top;$(h,"slide",n.settings.speed)}}n.settings.auto&&s.startAuto()}},s.goToNextSlide=function(){if(n.settings.infiniteLoop||!n.active.last){var e=parseInt(n.active.index)+1;s.goToSlide(e,"next")}},s.goToPrevSlide=function(){if(n.settings.infiniteLoop||0!=n.active.index){var e=parseInt(n.active.index)-1;s.goToSlide(e,"prev")}},s.startAuto=function(e){n.interval||(n.interval=setInterval(function(){"next"==n.settings.autoDirection?s.goToNextSlide():s.goToPrevSlide()},n.settings.pause),n.settings.autoControls&&1!=e&&L("stop"))},s.stopAuto=function(e){n.interval&&(clearInterval(n.interval),n.interval=null,n.settings.autoControls&&1!=e&&L("start"))},s.getCurrentSlide=function(){return n.active.index},s.getCurrentSlideElement=function(){return n.children.eq(n.active.index)},s.getSlideCount=function(){return n.children.length},s.redrawSlider=function(){n.children.add(s.find(".ui-clone")).width(f()),n.viewport.css("height",g()),n.settings.ticker||_(),n.active.last&&(n.active.index=v()-1),n.active.index>=v()&&(n.active.last=!0),n.settings.pager&&!n.settings.pagerCustom&&(y(),A(n.active.index))},s.destroySlider=function(){n.initialized&&(n.initialized=!1,e(".ui-clone",this).remove(),n.children.each(function(){void 0!=e(this).data("origStyle")?e(this).attr("style",e(this).data("origStyle")):e(this).removeAttr("style")}),void 0!=e(this).data("origStyle")?this.attr("style",e(this).data("origStyle")):e(this).removeAttr("style"),e(this).unwrap().unwrap(),n.controls.el&&n.controls.el.remove(),n.controls.next&&n.controls.next.remove(),n.controls.prev&&n.controls.prev.remove(),n.pagerEl&&n.settings.controls&&n.pagerEl.remove(),e(".ui-caption",this).remove(),n.controls.autoEl&&n.controls.autoEl.remove(),clearInterval(n.interval),n.settings.responsive&&e(window).unbind("resize",O))},s.reloadSlider=function(e){void 0!=e&&(a=e),s.destroySlider(),l()},l(),this}}(jQuery)},function(e,t){$.extend({miCountdown:function(e){var t={startTime:"",endTime:"",timer:"",upTime:!1,onTime:$.noop,onStart:$.noop,onEnd:$.noop},i=$.extend(t,e);if(i.startTime&&i.endTime){var o=$.isNumeric(i.startTime)?i.startTime:new Date(i.startTime).getTime()/1e3,a=$.isNumeric(i.endTime)?i.endTime:new Date(i.endTime).getTime()/1e3;window.diffTime=0;var n=function(){var e=parseInt((new Date).getTime()/1e3)+window.diffTime;if(window.surplusTime=o-e,i.timer&&clearTimeout(i.timer),i.upTime){if(e>=o&&a>e)"function"==typeof i.onStart&&i.onStart(a-e);else if(e>=a){if("function"==typeof i.onEnd)return void i.onEnd(e)}else i.onTime(window.surplusTime);i.timer=setTimeout(function(){n()},1e3)}else e>=o&&a>e?"function"==typeof i.onStart&&i.onStart(e):e>=a?"function"==typeof i.onEnd&&i.onEnd(e):(i.onTime(window.surplusTime),i.timer=setTimeout(function(){e+=1,n()},1e3))};return window.servertime?void n():void $.ajax({url:"//time.hd.mi.com/gettimestamp",dataType:"script",cache:!0,timeout:1e4,error:function(){window.servertime=(new Date).getTime()/1e3,n()},success:function(){window.servertime&&"number"==typeof window.servertime?(window.servertime=window.servertime,window.diffTime=window.servertime-parseInt((new Date).getTime()/1e3)):window.servertime=(new Date).getTime()/1e3,n()}})}}})},function(e,t,i){MI.proNav=function(e){if(0!==$("#J_proHeader").length){var t=i(8),o=$("#J_proHeader").find("h2").text();$("#J_proHeader").html(t(o)),window.tarList=[];var a=window.tarList,n=function(){var e=$(window).scrollTop();for(var t in a)if(a.hasOwnProperty(t)){var i=a[t],o=i.top;e>o?i.callback(i,e):i.reverse&&i.reverse(i,e)}};$(window).on("scroll",function(){n()}),0===$(".J_miOneScroller").length&&$("html,body").animate({scrollTop:1===$("#J_proHeader").length?$("#J_proHeader").offset().top:140},1e3),e=e||{};var s={id:e.id?e.id:"",target:e.target?e.target:""},r=function(){var e=140;1===$("#J_proHeader").length&&(e=$("#J_proHeader").offset().top+$("#J_proHeader").height());var t=e;a.push({top:t,callback:function(){$("#J_fixNarBar").addClass("nav_fix")},reverse:function(){$("#J_fixNarBar").removeClass("nav_fix")}})},d={};s.id?d.product_id=s.id:d.url="http://"+window.location.host+window.location.pathname,$.ajax({type:"GET",url:MI.GLOBAL_CONFIG.orderSite+"/product/gettabinfo",data:d,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,success:function(e){if(1===e.code&&(e=e.data,e.link)){e.link.id=s.id||e.link.product_id,e.link.target=s.target,e.link.domain=MI.GLOBAL_CONFIG.itemSite,e.link.url="//"+window.location.host+window.location.pathname;var t=i(9);$(".J_navSwitch").find(".con").html(t(e.link)),$(".J_buyBtn").attr("href",MI.GLOBAL_CONFIG.itemSite+"/product/"+e.link.id+".html"),r()}}})}}},function(e,t){e.exports=function(e){var t='<div class="xm-product-box"> <div class="nav-bar" id="J_headNav"> <div class="container J_navSwitch"> <h2 class="J_proName">'+e+'</h2> <div class="con"></div> </div> </div></div><div class="xm-product-box nav-bar-hidden" id="J_fixNarBar"> <div class="nav-bar" > <div class="container J_navSwitch"> <h2 class="J_proName">'+e+'</h2> <div class="con"></div> </div> </div></div>';return t}},function(e,t){e.exports=function(e){var t="";if(e.left&&e.left.length>0){t+='<div class="left"> ';var i=e.left;if(i)for(var o,a=-1,n=i.length-1;n>a;){o=i[a+=1],t+=" ";var s=o.url.replace(/^http:\/\/|^https:\/\//g,"//");t+=' <span class="separator">|</span> ',s===e.url?t+=' <a  href="javascript:void(0);" class="cur" >'+o.title+"</a> ":(t+=' <a  href="'+s+'" ',o.is_new_page&&(t+='target="_blank"'),t+=">"+o.title+"</a> "),t+=" "}t+="</div>"}if(t+='<div class="right">',e.right&&e.right.length>0){t+=" ";var r=e.right;if(r)for(var o,a=-1,d=r.length-1;d>a;){o=r[a+=1],t+=" ";var s=o.url.replace(/^http:\/\/|^https:\/\//g,"//");t+=" ",s===e.url?t+=' <a  href="javascript:void(0);" class="cur" >'+o.title+"</a> ":(t+=' <a  href="'+s+'" ',o.is_new_page&&(t+='target="_blank"'),t+=">"+o.title+"</a> "),t+=' <span class="separator">|</span> '}}return e.id&&(t+=" ","buy"===e.target&&(t+=' <a href="'+e.domain+"/comment/"+e.id+'.html">用户评价</a> '),t+=" ","comment"===e.target&&(t+=' <a href="javascript:void(0);" class="cur">用户评价</a> <a href="'+e.domain+"/product/"+e.id+'.html" class="btn btn-small btn-primary" >立即购买</a> '),t+=" ","buy"!==e.target&&"comment"!==e.target&&(t+=' <a href="'+e.domain+"/comment/"+e.id+'.html" >用户评价</a> <a href="'+e.domain+"/product/"+e.id+'.html" class="btn btn-small btn-primary" >立即购买</a> ')),t+="</div>"}},function(e,t,i){MI.alert=function(e){var t,o,a={msg:"温馨提示",isConfirm:!1,onCancel:$.noop,onConfirm:$.noop},n=$.extend(a,e),s=i(11),r=$("#J_miAlert");n.msg&&(r.length||($("body").append(s),r=$("#J_miAlert")),t=r.find("#J_miAlertCancel"),o=r.find("#J_miAlertConfirm"),n.isConfirm?("function"==typeof n.onCancel&&t.on("click",n.onCancel),"function"==typeof n.onConfirm&&o.on("click",n.onConfirm)):t.remove(),r.find("#J_miAlertMsg").html(n.msg),r.modal("show"))}},function(e,t){e.exports=function(e){var t='<div class="modal fade modal-hide  modal-alert" id="J_miAlert" > <a class="close" data-dismiss="modal"  href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a> <div class="modal-bd"> <div class="text"> <h3 id="J_miAlertMsg"></h3> </div> <div class="actions"> <button class="btn btn-gray" data-dismiss="modal" id="J_miAlertCancel">取消</button> <button class="btn btn-primary"  data-dismiss="modal" id="J_miAlertConfirm">确定</button> </div> </div></div>';return t}}]);